<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="xbim toolkit is an Open Source toolkit for IFC and BIM. You can use it to do anything with IFC. It implements IFC2x3 and IFC4 and allows to develop SW agnostic to IFC version and file format.">
    <meta name="author" content="xbim ltd.">
	<meta name="keywords" content="xbim,BIM,C#,CSharp,NET,OpenBIM,IFC,buildingSMART,standard,documentation,examples">
	<meta name="google-site-verification" content="0uIEEP0H5QWrL3gUPIdxOhMzGT0ZArO6rdpj9TOeeEQ" />

    <link rel="icon" href="../img/favicon.ico">

    <title>Spatial hierarchy</title>

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Google fonts -->
	<link target="_blank" href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;700&family=Roboto:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet"> 

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom styles for this template -->
    <link href="../css/codestyles.css" rel="stylesheet">
    <link href="../css/site.css" rel="stylesheet">

    <script src="../js/jquery.min.js"></script>

	<!-- Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-51899259-2', 'auto');
		ga('send', 'pageview');
	</script>

	<!-- JSON-LD markup generated by Google Structured Data Markup Helper. -->
	<script type="application/ld+json">
	{
	  "@context" : "http://schema.org",
	  "@type" : "SoftwareApplication",
	  "name" : "xbim toolkit",
	  "image" : "https://docs.xbim.net../img/xBim_toolkit_logo.png",
	  "url" : "https://docs.xbim.net/",
	  "author" : {
	    "@type" : "Person",
	    "name" : "prof. Steve Lockley"
	  },
	  "applicationCategory" : "BIM",
	  "downloadUrl" : "https://www.nuget.org/packages?q=xbim",
	  "softwareVersion" : "4.0"
	}
	</script>
  </head>
<!-- NAVBAR
================================================== -->
  <body>

    <nav class="navbar navbar-inverse">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html"><img alt="logo" src="../img/xBim_toolkit_logo.png"/></a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          		   
	<ul class="nav navbar-nav">
		
        <li>
			<a href="../quick-start.html">Quick Start</a>
		</li>
		
        <li>
			<a href="../docs.html">Docs</a>
		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Examples <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../examples/examples-list.html">Examples list</a>
		</li>
		<li role="separator" class="group-divider">Basic </li>
		
        <li>
			<a href="../examples/basic-model-operations.html">Basic Model Operations</a>
		</li>
		
        <li>
			<a href="../examples/watch-the-log.html">Watch the log!</a>
		</li>
		
        <li>
			<a href="../examples/proper-wall-in-3d.html">Proper Wall in 3D</a>
		</li>
		
        <li>
			<a href="../examples/step-to-xml-and-back-again.html">STEP to XML and Back Again</a>
		</li>
		
        <li>
			<a href="../examples/creating-wexbim-file.html">Creating wexBIM file</a>
		</li>
		
        <li>
			<a href="../examples/using-linq-for-optimal-performance.html">Using LINQ for Optimal Performance</a>
		</li>
		
        <li>
			<a href="../examples/excel-space-report-from-ifc.html">Excel Space Report from IFC</a>
		</li>
        <li class="active">
			<a href="../examples/spatial-hierarchy.html">Spatial hierarchy</a>
		</li>
		<li role="separator" class="group-divider">Advanced </li>
		
        <li>
			<a href="../examples/federating-models.html">Federating Models</a>
		</li>
		
        <li>
			<a href="../examples/insert-copy-function.html">Insert Copy Function</a>
		</li>
		
        <li>
			<a href="../examples/change-log-creation.html">Change Log Creation</a>
		</li>
		<li role="separator" class="group-divider">Downloads </li>
		
        <li>
			<a href="../examples/xbimxplorer.html">XbimXplorer</a>
		</li>
		<li role="separator" class="group-divider">Web UI  </li>
		
        <li>
			<a href="../examples/hello-building.html">Hello Building</a>
		</li>
		
        <li>
			<a href="../examples/safe-hello-building.html">Safe Hello Building</a>
		</li>
		
        <li>
			<a href="../examples/eventful-building.html">Eventful Building</a>
		</li>
		
        <li>
			<a href="../examples/building-seen-from-everywhere.html">Building Seen from Everywhere</a>
		</li>
		
        <li>
			<a href="../examples/colourful-building.html">Colourful Building</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Release notes <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../release-notes/fast-upgrade-track.html">Fast Upgrade Track</a>
		</li>
		
        <li>
			<a href="../release-notes/xbim-4-release-notes.html">xBIM 4 Release Notes</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Research <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../research/history.html">History</a>
		</li>
		
        <li>
			<a href="../research/how-to-reference.html">How to reference</a>
		</li>
		
        <li>
			<a href="../research/ifc2x3-test-harness.html">Ifc2X3 Test Harness</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Downloads <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../downloads/xbimxplorer.html">XbimXplorer</a>
		</li>
    </ul>

		</li>
		
        <li>
			<a href="../cloud.html">Cloud</a>
		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">License <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../license/license.html">License</a>
		</li>
		
        <li>
			<a href="../license/third-party-licenses.html">Third Party Licenses</a>
		</li>
    </ul>

		</li>
    </ul>

        </div><!--/.nav-collapse -->
      </div>
    </nav>

	<div class="container">
	<h1>Spatial hierarchy from IFC</h1>

<p>This very simple example shows how to retrieve spatial structure from the file. Spatial structure in IFC means nested structure of 
the hierarchy representing project, site, building, storey and space. If you have a look at <a target="_blank" href="http://www.buildingsmart-tech.org/ifc/IFC4/Add2/html/link/ifcspace.htm">IFC documentation</a>
you will find that building can contain storeys as well as other buildings, storey can contain spaces as well as other storeys
and so on. Also this kind of relation is modeled using <a target="_blank" href="http://www.buildingsmart-tech.org/ifc/IFC4/Add2/html/link/ifcrelaggregates.htm">IfcRelAggregates</a>
but if you want to find elements contained in the particular spatial structure it is modeled as 
<a target="_blank" href="http://www.buildingsmart-tech.org/ifc/IFC4/Add2/html/link/ifcrelcontainedinspatialstructure.htm">IfcRelContainedInSpatialStructure</a>
so it depends what you want to find. Following example shows how to search and traverse the data to get complete hierarchy using the two relations mentioned above.</p>

<div class="csharp"><pre><code><span class="keyword">using</span> <span class="type">System</span>;
<span class="keyword">using</span> <span class="type">System</span>.Linq;
<span class="keyword">using</span> <span class="type">Xbim</span>.Ifc;
<span class="keyword">using</span> <span class="type">Xbim</span>.Ifc4.Interfaces;

<span class="keyword">namespace</span> <span class="type">BasicExamples</span>
{
    <span class="keyword">class</span> <span class="type">SpatialStructureExample</span>
    {
        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> Show()
        {
            <span class="keyword">const</span> <span class="keyword">string</span> file = <span class="string">&quot;SampleHouse.ifc&quot;</span>;

            <span class="keyword">using</span> (<span class="keyword">var</span> model = <span class="type">IfcStore</span>.Open(file))
            {
                <span class="keyword">var</span> project = model.Instances.FirstOrDefault&lt;<span class="type">IIfcProject</span>&gt;();
                PrintHierarchy(project, 0);
            }
        }

        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> PrintHierarchy(<span class="type">IIfcObjectDefinition</span> o, <span class="keyword">int</span> level)
        {
            <span class="type">Console</span>.WriteLine(<span class="keyword">string</span>.Format(<span class="string">&quot;{0}{1} [{2}]&quot;</span>, GetIndent(level), o.Name, o.GetType().Name));

            <span class="comment">//only spatial elements can contain building elements</span>
            <span class="keyword">var</span> spatialElement = o <span class="keyword">as</span> <span class="type">IIfcSpatialStructureElement</span>;
            <span class="keyword">if</span> (spatialElement != <span class="keyword">null</span>)
            {
                <span class="comment">//using IfcRelContainedInSpatialElement to get contained elements</span>
                <span class="keyword">var</span> containedElements = spatialElement.ContainsElements.SelectMany(rel =&gt; rel.RelatedElements);
                <span class="keyword">foreach</span> (<span class="keyword">var</span> element <span class="keyword">in</span> containedElements)
                    <span class="type">Console</span>.WriteLine(<span class="keyword">string</span>.Format(<span class="string">&quot;{0}    -&gt;{1} [{2}]&quot;</span>, GetIndent(level), element.Name, element.GetType().Name));
            }

            <span class="comment">//using IfcRelAggregares to get spatial decomposition of spatial structure elements</span>
            <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> o.IsDecomposedBy.SelectMany(r =&gt; r.RelatedObjects))
                PrintHierarchy(item, level +1);
        }

        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> GetIndent(<span class="keyword">int</span> level)
        {
            <span class="keyword">var</span> indent = <span class="string">&quot;&quot;</span>;
            <span class="keyword">for</span> (<span class="keyword">int</span> i = 0; i &lt; level; i++)
                indent += <span class="string">&quot;  &quot;</span>;
            <span class="keyword">return</span> indent;
        }
    }
}

</code></pre></div>

<p>This will give you following output for our sample model:</p>

<pre><code>Project Number [IfcProject]
  Default [IfcSite]
     [IfcBuilding]
      Ground Floor [IfcBuildingStorey]
          ->Basic Wall:Wall-Ext_102Bwk-75Ins-100LBlk-12P:285330 [IfcWall]
          ->Basic Wall:Wall-Ext_102Bwk-75Ins-100LBlk-12P:285395 [IfcWall]
          ->Basic Wall:Wall-Ext_102Bwk-75Ins-100LBlk-12P:285459 [IfcWall]
          ->Curtain Wall:Curtain_Wall-Exterior_Glazing:285582 [IfcCurtainWall]
          ->Curtain Wall:Curtain_Wall-Exterior_Glazing:285684 [IfcCurtainWall]
          ->Basic Wall:Wall-Partn_12P-70MStd-12P:285792 [IfcWallStandardCase]
          ->Basic Wall:Wall-Partn_12P-70MStd-12P:285846 [IfcWallStandardCase]
          ->Doors_ExtDbl_Flush:1810x2110mm:285860 [IfcDoor]
          ->Doors_IntSgl:810x2110mm:285959 [IfcDoor]
          ->Doors_IntSgl:810x2110mm:285996 [IfcDoor]
          ->Windows_Sgl_Plain:1810x1210mm:286105 [IfcWindow]
          ->Windows_Sgl_Plain:1810x1210mm:286188 [IfcWindow]
          ->Windows_Sgl_Plain:1810x1210mm:286238 [IfcWindow]
          ->Compound Ceiling:Plain:286319 [IfcCovering]
          ->Compound Ceiling:Plain:286329 [IfcCovering]
          ->Compound Ceiling:Plain:286337 [IfcCovering]
          ->Floor:Floor-Grnd-Susp_65Scr-80Ins-100Blk-75PC:286349 [IfcSlab]
          ->Windows_Sgl_Plain:1810x1210mm:287567 [IfcWindow]
        1 - Living room [IfcSpace]
            ->Furniture_Table_Dining_w-Chairs_Rectangular:2000x1000x750mm_w-6_Seats:289768 [IfcFurniture]
            ->Chair - Dining:Chair - Dining:289769 [IfcFurniture]
            ->Chair - Dining:Chair - Dining:289770 [IfcFurniture]
            ->Chair - Dining:Chair - Dining:289771 [IfcFurniture]
            ->Chair - Dining:Chair - Dining:289772 [IfcFurniture]
            ->Chair - Dining:Chair - Dining:290097 [IfcFurniture]
            ->Chair - Dining:Chair - Dining:290098 [IfcFurniture]
            ->Furniture_Couch_Viper:2290x950x340mm:290852 [IfcFurniture]
            ->Furniture_Chair_Viper:1120x940x350mm:291916 [IfcFurniture]
            ->Furniture_Chair_Viper:1120x940x350mm:292127 [IfcFurniture]
            ->Furniture_Table_Coffee_1:1200x550x450mm:293046 [IfcFurniture]
            ->Furniture_Piano:1370x600x1170mm:293961 [IfcFurniture]
        2 - Bedroom [IfcSpace]
            ->Furniture_Desk:1525x762mm:287689 [IfcFurniture]
            ->Furniture_Bed_1:1525x2007x355mm-Queen:295878 [IfcFurniture]
        3 - Entrance hall [IfcSpace]
      Roof [IfcBuildingStorey]
          ->Basic Roof:Roof_Flat-4Felt-150Ins-50Scr-150Conc-12Plr:286419 [IfcRoof]
          ->Floor:Simple floor:295048 [IfcSlab]
        4 - Roof [IfcSpace]
</code></pre>

    </div>
    

	<div class="brands-container">
	<p><small>Some of the companies using xbim toolkit:</small></p>
		<a target="_blank" href="https://www.xbim.net"><img style="height:65px;" src="../img/xBim_parent_logo_white.svg" class="brand" alt="xbim ltd."></a>
		<img src="../img/logos/northumbria_logo_gray.png" class="brand"/>
		<img src="../img/logos/viewpoint_logo_gray.png" class="brand"/>
		<img src="../img/logos/welplan_logo_gray.png" class="brand"/>
		<img src="../img/logos/nbs_logo_gray.png" class="brand"/>
		<img src="../img/logos/bim_academy_logo_gray.png" class="brand"/>
		<img src="../img/logos/di5_logo_gray.png" class="brand"/>
		<img src="../img/logos/SEMA_logo_gray.png" class="brand"/>
	</div>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
