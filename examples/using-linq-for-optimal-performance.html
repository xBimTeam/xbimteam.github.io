<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="xBIM Toolkit is an Open Source toolkit for IFC and BIM. You can use it to do anything with IFC. It implements IFC2x3 and IFC4 and allows to develop SW agnostic to IFC version and file format.">
    <meta name="author" content="xBIM Team">
	<meta name="keywords" content="xBIM,BIM,C#,CSharp,NET,OpenBIM,IFC,buildingSMART,standard,documentation,examples">
	<meta name="google-site-verification" content="0uIEEP0H5QWrL3gUPIdxOhMzGT0ZArO6rdpj9TOeeEQ" />

    <link rel="icon" href="../img/favicon.ico">

    <title>Using LINQ for Optimal Performance</title>

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Google fonts -->
	<link target="_blank" href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;700&family=Roboto:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet"> 

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom styles for this template -->
    <link href="../css/codestyles.css" rel="stylesheet">
    <link href="../css/site.css" rel="stylesheet">

    <script src="../js/jquery.min.js"></script>

	<!-- Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-51899259-2', 'auto');
		ga('send', 'pageview');
	</script>

	<!-- JSON-LD markup generated by Google Structured Data Markup Helper. -->
	<script type="application/ld+json">
	{
	  "@context" : "http://schema.org",
	  "@type" : "SoftwareApplication",
	  "name" : "xBIM Toolkit",
	  "image" : "https://docs.xbim.net../img/xBim_toolkit_logo.png",
	  "url" : "https://docs.xbim.net/",
	  "author" : {
	    "@type" : "Person",
	    "name" : "prof. Steve Lockley"
	  },
	  "applicationCategory" : "BIM",
	  "downloadUrl" : "https://www.nuget.org/packages?q=xbim",
	  "softwareVersion" : "4.0"
	}
	</script>
  </head>
<!-- NAVBAR
================================================== -->
  <body>

    <nav class="navbar navbar-inverse">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html"><img alt="logo" src="../img/xBim_toolkit_logo.png"/></a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          		   
	<ul class="nav navbar-nav">
		
        <li>
			<a href="../quick-start.html">Quick Start</a>
		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Examples <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../examples/examples-list.html">Examples list</a>
		</li>
		<li role="separator" class="group-divider">Basic </li>
		
        <li>
			<a href="../examples/basic-model-operations.html">Basic Model Operations</a>
		</li>
		
        <li>
			<a href="../examples/watch-the-log.html">Watch the log!</a>
		</li>
		
        <li>
			<a href="../examples/proper-wall-in-3d.html">Proper Wall in 3D</a>
		</li>
		
        <li>
			<a href="../examples/step-to-xml-and-back-again.html">STEP to XML and Back Again</a>
		</li>
		
        <li>
			<a href="../examples/creating-wexbim-file.html">Creating wexBIM file</a>
		</li>
        <li class="active">
			<a href="../examples/using-linq-for-optimal-performance.html">Using LINQ for Optimal Performance</a>
		</li>
		
        <li>
			<a href="../examples/excel-space-report-from-ifc.html">Excel Space Report from IFC</a>
		</li>
		
        <li>
			<a href="../examples/spatial-hierarchy.html">Spatial hierarchy</a>
		</li>
		<li role="separator" class="group-divider">Advanced </li>
		
        <li>
			<a href="../examples/federating-models.html">Federating Models</a>
		</li>
		
        <li>
			<a href="../examples/insert-copy-function.html">Insert Copy Function</a>
		</li>
		
        <li>
			<a href="../examples/change-log-creation.html">Change Log Creation</a>
		</li>
		<li role="separator" class="group-divider">Downloads </li>
		
        <li>
			<a href="../examples/xbimxplorer.html">XbimXplorer</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Release notes <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../release-notes/fast-upgrade-track.html">Fast Upgrade Track</a>
		</li>
		
        <li>
			<a href="../release-notes/xbim-4-release-notes.html">xBIM 4 Release Notes</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Research <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../research/history.html">History</a>
		</li>
		
        <li>
			<a href="../research/how-to-reference.html">How to reference</a>
		</li>
		
        <li>
			<a href="../research/ifc2x3-test-harness.html">Ifc2X3 Test Harness</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Downloads <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../downloads/xbimxplorer.html">XbimXplorer</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">License <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../license/license.html">License</a>
		</li>
		
        <li>
			<a href="../license/third-party-licenses.html">Third Party Licenses</a>
		</li>
    </ul>

		</li>
		
        <li>
			<a href="../cloud.html">Cloud</a>
		</li>
    </ul>

        </div><!--/.nav-collapse -->
      </div>
    </nav>

	<div class="container">
	<h1>Using <a target="_blank" href="https://msdn.microsoft.com/en-us/library/mt693052.aspx">LINQ</a> for Optimal Performance</h1>

<p><a target="_blank" href="https://msdn.microsoft.com/en-us/library/mt693052.aspx">LINQ</a> stands for a Language-Integrated Query and it is part .NET Framework
since version 3.5. It implements deferred execution which means you can chain the query statements and it will do nothing until you 
actually iterate over the result. You can either use LINQ as a <a target="_blank" href="https://msdn.microsoft.com/en-us/library/bb397927.aspx">specific language</a> or
you can use <a target="_blank" href="https://msdn.microsoft.com/en-us/library/9eekhta0.aspx">extension methods</a> from <code>System.Linq</code> which extend <code>IEnumerable&lt;T&gt;</code> 
interface and can get arguments as lambda expressions. We prefer the later approach but it is equivalent. 
Following example shows both variants to do the same. The result of both queries is enumeration of the globally unique IDs of the walls which have any opening.</p>

<div class="csharp"><pre><code><span class="comment">//expression using LINQ</span>
<span class="keyword">var</span> ids =
    <span class="keyword">from</span> wall <span class="keyword">in</span> model.Instances.OfType&lt;<span class="type">IIfcWall</span>&gt;()
    <span class="keyword">where</span> wall.HasOpenings.Any()
    <span class="keyword">select</span> wall.GlobalId;
</code></pre></div>

<div class="csharp"><pre><code><span class="comment">//equivalent expression using chained extensions of IEnumerable and lambda expressions</span>
<span class="keyword">var</span> ids =
    model.Instances
    .Where&lt;<span class="type">IIfcWall</span>&gt;(wall =&gt; wall.HasOpenings.Any())
    .Select(wall =&gt; wall.GlobalId);
</code></pre></div>

<p>You can see in the code that we called <code>Where()</code> function directly on <code>IModel.Instances</code>. <code>IEntityCollection</code> implementations  implement overloads for most of Linq 
data retrieval methods like <code>Where&lt;T&gt;()</code>, <code>Count&lt;T&gt;()</code>, <code>FirstOrDefault&lt;T&gt;()</code> and <code>OfType&lt;T&gt;()</code> and it is optimized on the lowest level for fast data access.
All these methods return <code>IEnumerable&lt;T&gt;</code> so you can chain it with other methods to perform further selections, aggregation, sorting and other operations. 
<code>IEntityCollection</code> functions also use deferred execution so it fits very well with Linq concepts. You should only force it to enumerate if you are going to use
the result more than once. You can do that by calling one of <code>ToList&lt;T&gt;()</code>, <code>ToArray&lt;T&gt;()</code>or <code>ToDictionary&lt;T&gt;()</code> methods.</p>

<p>xBIM uses type of entities internally as the first level filter so you should always ask for the most specific type you can. 
Keep in mind that <code>IModel.Instances</code> contains <strong>all</strong> entities in the model which is typically hundreds of thousands of objects! 
So you don't want to iterate over all of them to do anything. See following good and bad example which do the same but not quite the same:</p>

<div class="csharp"><pre><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> SelectionWithLinq()
{
    <span class="keyword">const</span> <span class="keyword">string</span> ifcFilename = <span class="string">&quot;SampleHouse.ifc&quot;</span>;
    <span class="keyword">var</span> model = <span class="type">IfcStore</span>.Open(ifcFilename);
    <span class="keyword">using</span> (<span class="keyword">var</span> txn = model.BeginTransaction())
    {
        <span class="keyword">var</span> requiredProducts = <span class="keyword">new</span> <span class="type">IIfcProduct</span>[0]
            .Concat(model.Instances.OfType&lt;<span class="type">IIfcWallStandardCase</span>&gt;())
            .Concat(model.Instances.OfType&lt;<span class="type">IIfcDoor</span>&gt;())
            .Concat(model.Instances.OfType&lt;<span class="type">IIfcWindow</span>&gt;());

        <span class="comment">//This will only iterate over entities you really need (9 in this case)</span>
        <span class="keyword">foreach</span> (<span class="keyword">var</span> product <span class="keyword">in</span> requiredProducts)
        {
            <span class="comment">//Do anything you want here...</span>
        }

        txn.Commit();
    }
}
</code></pre></div>

<div class="alert alert-danger" role="alert"> 
    <p>
        The Following code example is about <strong>4.5 times slower!!!</strong>
    </p>
    <strong>Please, never use this kind of code:</strong>
</div>

<div class="csharp"><pre><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> SelectionWithoutLinqIsSLOW()
{
    <span class="keyword">const</span> <span class="keyword">string</span> ifcFilename = <span class="string">&quot;SampleHouse.ifc&quot;</span>;
    <span class="keyword">var</span> model = <span class="type">IfcStore</span>.Open(ifcFilename);
    <span class="keyword">using</span> (<span class="keyword">var</span> txn = model.BeginTransaction())
    {
        <span class="comment">//this will iterate over 47309 entities instead of just 9 you need in this case!</span>
        <span class="keyword">foreach</span> (<span class="keyword">var</span> entity <span class="keyword">in</span> model.Instances)
        {
            <span class="keyword">if</span> (entity <span class="keyword">is</span> <span class="type">IIfcWallStandardCase</span> ||
                entity <span class="keyword">is</span> <span class="type">IIfcDoor</span> ||
                entity <span class="keyword">is</span> <span class="type">IIfcWindow</span>)
            {
                <span class="comment">//You may want to do something here. Please DON&#39;T!</span>
            }
        }
        txn.Commit();
    }
}
</code></pre></div>

    </div>
    

	<div class="brands-container">
	<p><small>Some of the companies using xBIM Toolkit:</small></p>
		<a target="_blank" href="https://www.xbim.net"><img style="height:65px;" src="../img/xBim_parent_logo_white.svg" class="brand" alt="xbim ltd."></a>
		<img src="../img/logos/northumbria_logo_gray.png" class="brand"/>
		<img src="../img/logos/viewpoint_logo_gray.png" class="brand"/>
		<img src="../img/logos/welplan_logo_gray.png" class="brand"/>
		<img src="../img/logos/nbs_logo_gray.png" class="brand"/>
		<img src="../img/logos/bim_academy_logo_gray.png" class="brand"/>
		<img src="../img/logos/di5_logo_gray.png" class="brand"/>
		<img src="../img/logos/SEMA_logo_gray.png" class="brand"/>
	</div>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
