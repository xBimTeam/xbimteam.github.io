<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="xbim toolkit is an Open Source toolkit for IFC and BIM. You can use it to do anything with IFC. It implements IFC2x3 and IFC4 and allows to develop SW agnostic to IFC version and file format.">
    <meta name="author" content="xbim ltd.">
	<meta name="keywords" content="xbim,BIM,C#,CSharp,NET,OpenBIM,IFC,buildingSMART,standard,documentation,examples">
	<meta name="google-site-verification" content="0uIEEP0H5QWrL3gUPIdxOhMzGT0ZArO6rdpj9TOeeEQ" />

    <link rel="icon" href="../img/favicon.ico">

    <title>Eventful Building</title>

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Google fonts -->
	<link target="_blank" href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;700&family=Roboto:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet"> 

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom styles for this template -->
    <link href="../css/codestyles.css" rel="stylesheet">
    <link href="../css/site.css" rel="stylesheet">

    <script src="../js/jquery.min.js"></script>

	<!-- Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-51899259-2', 'auto');
		ga('send', 'pageview');
	</script>

	<!-- JSON-LD markup generated by Google Structured Data Markup Helper. -->
	<script type="application/ld+json">
	{
	  "@context" : "http://schema.org",
	  "@type" : "SoftwareApplication",
	  "name" : "xbim toolkit",
	  "image" : "https://docs.xbim.net../img/xBim_toolkit_logo.png",
	  "url" : "https://docs.xbim.net/",
	  "author" : {
	    "@type" : "Person",
	    "name" : "prof. Steve Lockley"
	  },
	  "applicationCategory" : "BIM",
	  "downloadUrl" : "https://www.nuget.org/packages?q=xbim",
	  "softwareVersion" : "4.0"
	}
	</script>
  </head>
<!-- NAVBAR
================================================== -->
  <body>

    <nav class="navbar navbar-inverse">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html"><img alt="logo" src="../img/xBim_toolkit_logo.png"/></a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          		   
	<ul class="nav navbar-nav">
		
        <li>
			<a href="../quick-start.html">Quick Start</a>
		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Examples <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../examples/examples-list.html">Examples list</a>
		</li>
		<li role="separator" class="group-divider">Basic </li>
		
        <li>
			<a href="../examples/basic-model-operations.html">Basic Model Operations</a>
		</li>
		
        <li>
			<a href="../examples/watch-the-log.html">Watch the log!</a>
		</li>
		
        <li>
			<a href="../examples/proper-wall-in-3d.html">Proper Wall in 3D</a>
		</li>
		
        <li>
			<a href="../examples/step-to-xml-and-back-again.html">STEP to XML and Back Again</a>
		</li>
		
        <li>
			<a href="../examples/creating-wexbim-file.html">Creating wexBIM file</a>
		</li>
		
        <li>
			<a href="../examples/using-linq-for-optimal-performance.html">Using LINQ for Optimal Performance</a>
		</li>
		
        <li>
			<a href="../examples/excel-space-report-from-ifc.html">Excel Space Report from IFC</a>
		</li>
		
        <li>
			<a href="../examples/spatial-hierarchy.html">Spatial hierarchy</a>
		</li>
		<li role="separator" class="group-divider">Advanced </li>
		
        <li>
			<a href="../examples/federating-models.html">Federating Models</a>
		</li>
		
        <li>
			<a href="../examples/insert-copy-function.html">Insert Copy Function</a>
		</li>
		
        <li>
			<a href="../examples/change-log-creation.html">Change Log Creation</a>
		</li>
		<li role="separator" class="group-divider">Downloads </li>
		
        <li>
			<a href="../examples/xbimxplorer.html">XbimXplorer</a>
		</li>
		<li role="separator" class="group-divider">Web UI  </li>
		
        <li>
			<a href="../examples/hello-building.html">Hello Building</a>
		</li>
		
        <li>
			<a href="../examples/safe-hello-building.html">Safe Hello Building</a>
		</li>
        <li class="active">
			<a href="../examples/eventful-building.html">Eventful Building</a>
		</li>
		
        <li>
			<a href="../examples/building-seen-from-everywhere.html">Building Seen from Everywhere</a>
		</li>
		
        <li>
			<a href="../examples/colourful-building.html">Colourful Building</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Release notes <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../release-notes/fast-upgrade-track.html">Fast Upgrade Track</a>
		</li>
		
        <li>
			<a href="../release-notes/xbim-4-release-notes.html">xBIM 4 Release Notes</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Research <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../research/history.html">History</a>
		</li>
		
        <li>
			<a href="../research/how-to-reference.html">How to reference</a>
		</li>
		
        <li>
			<a href="../research/ifc2x3-test-harness.html">Ifc2X3 Test Harness</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Downloads <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../downloads/xbimxplorer.html">XbimXplorer</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">License <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../license/license.html">License</a>
		</li>
		
        <li>
			<a href="../license/third-party-licenses.html">Third Party Licenses</a>
		</li>
    </ul>

		</li>
		
        <li>
			<a href="../cloud.html">Cloud</a>
		</li>
    </ul>

        </div><!--/.nav-collapse -->
      </div>
    </nav>

	<div class="container">
	<blockquote>
  <p>Warning: We have just published new version of the viewer, so this tutorial migh not be 100% right</p>
</blockquote>

<h2>Live example <a href="3_Eventful_building.live.html">here</a></h2>

<p>In this tutorial we'll have a look on events fired by the viewer on different occasions. 
All of them are documented in {@link Viewer Viewer}. You can see full live example <a href="3_Eventful_building.live.html">here</a> 
if you are running this tutorial from web server. Alsso make sure your webserver is set up to serve wexBIM files as
a static content. If you don't want to set up any complex webserver I recommend <a target="_blank" href="https://code.google.com/p/mongoose/">Mongoose</a>. 
Just run the executable in the executable in Docs folder and browse to tutorial or the live example.</p>

<p>I'll use ugly obtrusive code with javascript functions defined in <em>onclick</em> attributes of HTML elements. This is not the right practise
but I've done it this way for the sake of clarity and simplicity. You are ancouraged to follow 
<a target="_blank" href="http://www.w3.org/wiki/The_principles_of_unobtrusive_JavaScript">these guidlines</a> to write sustainable
and clear web applications.</p>

<p>And now, let's dig into the code. It is pretty easy to register your handler with the following function:</p>

<pre><code>viewer.on('event_name', callback); //see documentation {@link Viewer#on here}.
</code></pre>

<p>You can also remove handler with similar code if you are not interested in it any more:</p>

<pre><code>viewer.off('event_name', callback); //see documentation {@link Viewer#off here}.
</code></pre>

<p>We will show some of the most useful events you might want to watch in the following example. 
It is based on the previous tutorial {@tutorial 2<em>Safe</em>Hello_building} so we won't list full
page code but rather code snippets. To see a complete example have a look on the code of 
<a href="3_Eventful_building.live.html">live example</a>.</p>

<p>I'll show you complete listing of the new code now. It is pretty much self explaining but I'll cover 
every event in the following text.</p>

<pre><code>viewer.on('loaded', function () {
    //Hide any loaders you have used to keep your user excited 
    //while their precious models are being processed and loaded
    //and start the animation.
    viewer.start();
});

viewer.on('error', function (arg) {
    var container = document.getElementById('errors');
    if (container) {
        //preppend error report
        container.innerHTML = "&lt;pre style='color:red;'&gt;" + arg.message + "&lt;/pre&gt; &lt;br /&gt;" + container.innerHTML;
    }
});

viewer.on('fps', function (fps) {
    var span = document.getElementById('fps');
    if (span) {
        span.innerHTML = fps;
    }
});

var timer = 0;
viewer.on('pick', function (args) {
    var id = args.id;

    var span = document.getElementById('productId');
    if (span) {
        span.innerHTML = id;
    }

    //you can use ID for funny things like hiding or 
    //recolouring which will be covered in one of the next tutorials

    var time = (new Date()).getTime();
    if (time - timer &lt; 200)
        viewer.zoomTo(id);
    timer = time;

});
viewer.on('mouseDown', function (args) {
    viewer.setCameraTarget(args.id);
});
</code></pre>

<p>So, let's have a look on the {@link Viewer#event:loaded loaded} event. It is the first one to occur 
and you are likely to use it to hide any loader images you may have used to keep users attention.
It is also better to start animation when model is loaded already. However, viewer won't crash
if you start it at any time. </p>

<pre><code>viewer.on('loaded', function () {
    //Hide any loaders you have used to keep your user excited 
    //while their precious models are being processed and loaded
    //and start the animation.
    viewer.start();
});
</code></pre>

<p>{@link Viewer#event:error Error} is very important event to listen to and you should listen to it 
all the time. You should still use try-catch statements but this might report some useful
information. It's up to you if you expose messages to user but you should watch it carefully.</p>

<pre><code>viewer.on('error', function (arg) {
    var container = document.getElementById('errors');
    if (container) {
        //preppend error report
        container.innerHTML = "&lt;pre style='color:red;'&gt;" + arg.message + "&lt;/pre&gt; &lt;br /&gt;" + container.innerHTML;
    }
});
</code></pre>

<p>{@link Viewer#event:fps FPS} stands for 'frames per second'. This event is fired every 30<sup>th</sup> frame.
It is one of the performance indicators. Viewer's animation loop it bound to refresh of the browser screen
so it won't usually exceed 60fps. If you get bellow about 15fps user experience starts to be a bit sluggish.</p>

<pre><code>viewer.on('fps', function (fps) {
    var span = document.getElementById('fps');
    if (span) {
        span.innerHTML = fps;
    }
});
</code></pre>

<p>{@link Viewer#event:pick Pick} is probably the most important user interaction event. It happens every time
when user clicks on the area of <code>&lt;canvas&gt;</code>. It's argument contains product ID which you can use for things
like selection, restyling and other interactive operations. This example also implements simple double click
handler which zooms to picked product. If user clicks out of the model ID is null.</p>

<pre><code>var timer = 0;
viewer.on('pick', function (args) {
    var id = args.id;

    var span = document.getElementById('productId');
    if (span) {
        span.innerHTML = id;
    }

    //you can use ID for funny things like hiding or 
    //recolouring which will be covered in one of the next tutorials

    var time = (new Date()).getTime();
    if (time - timer &lt; 200)
        viewer.zoomTo(id);
    timer = time;

});
</code></pre>

<p>{@link Viewer#event:mousedown Mouse down} is another user interaction event. It happens every time when mouseDown event
happens in <code>&lt;canvas&gt;</code>. It contains the same argument as {@link Viewer#event:pick pick} event which is product ID or null 
if user clicks to empty space.</p>

<pre><code>viewer.on('mouseDown', function (args) {
    viewer.setCameraTarget(args.id);
});
</code></pre>

<p>You can inspect full code in <a href="3_Eventful_building.live.html">live example</a>.</p>

    </div>
    

	<div class="brands-container">
	<p><small>Some of the companies using xbim toolkit:</small></p>
		<a target="_blank" href="https://www.xbim.net"><img style="height:65px;" src="../img/xBim_parent_logo_white.svg" class="brand" alt="xbim ltd."></a>
		<img src="../img/logos/northumbria_logo_gray.png" class="brand"/>
		<img src="../img/logos/viewpoint_logo_gray.png" class="brand"/>
		<img src="../img/logos/welplan_logo_gray.png" class="brand"/>
		<img src="../img/logos/nbs_logo_gray.png" class="brand"/>
		<img src="../img/logos/bim_academy_logo_gray.png" class="brand"/>
		<img src="../img/logos/di5_logo_gray.png" class="brand"/>
		<img src="../img/logos/SEMA_logo_gray.png" class="brand"/>
	</div>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
