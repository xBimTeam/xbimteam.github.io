<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="xbim toolkit is an Open Source toolkit for IFC and BIM. You can use it to do anything with IFC. It implements IFC2x3 and IFC4 and allows to develop SW agnostic to IFC version and file format.">
    <meta name="author" content="xbim ltd.">
	<meta name="keywords" content="xbim,BIM,C#,CSharp,NET,OpenBIM,IFC,buildingSMART,standard,documentation,examples">
	<meta name="google-site-verification" content="0uIEEP0H5QWrL3gUPIdxOhMzGT0ZArO6rdpj9TOeeEQ" />

    <link rel="icon" href="../img/favicon.ico">

    <title>Change Log Creation</title>

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Google fonts -->
	<link target="_blank" href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;700&family=Roboto:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet"> 

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom styles for this template -->
    <link href="../css/codestyles.css" rel="stylesheet">
    <link href="../css/site.css" rel="stylesheet">

    <script src="../js/jquery.min.js"></script>

	<!-- Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-51899259-2', 'auto');
		ga('send', 'pageview');
	</script>

	<!-- JSON-LD markup generated by Google Structured Data Markup Helper. -->
	<script type="application/ld+json">
	{
	  "@context" : "http://schema.org",
	  "@type" : "SoftwareApplication",
	  "name" : "xbim toolkit",
	  "image" : "https://docs.xbim.net../img/xBim_toolkit_logo.png",
	  "url" : "https://docs.xbim.net/",
	  "author" : {
	    "@type" : "Person",
	    "name" : "prof. Steve Lockley"
	  },
	  "applicationCategory" : "BIM",
	  "downloadUrl" : "https://www.nuget.org/packages?q=xbim",
	  "softwareVersion" : "4.0"
	}
	</script>
  </head>
<!-- NAVBAR
================================================== -->
  <body>
    <nav class="navbar navbar-inverse">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html"><img alt="logo" src="../img/xBim_toolkit_logo.png"/></a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          		   
	<ul class="nav navbar-nav">
		
        <li>
			<a href="../quick-start.html">Quick Start</a>
		</li>
		
        <li>
			<a href="../docs.html">Docs</a>
		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Examples <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../examples/examples-list.html">Examples list</a>
		</li>
		<li role="separator" class="group-divider">Basic </li>
		
        <li>
			<a href="../examples/basic-model-operations.html">Basic Model Operations</a>
		</li>
		
        <li>
			<a href="../examples/watch-the-log.html">Watch the log!</a>
		</li>
		
        <li>
			<a href="../examples/proper-wall-in-3d.html">Proper Wall in 3D</a>
		</li>
		
        <li>
			<a href="../examples/step-to-xml-and-back-again.html">STEP to XML and Back Again</a>
		</li>
		
        <li>
			<a href="../examples/creating-wexbim-file.html">Creating wexBIM file</a>
		</li>
		
        <li>
			<a href="../examples/using-linq-for-optimal-performance.html">Using LINQ for Optimal Performance</a>
		</li>
		
        <li>
			<a href="../examples/excel-space-report-from-ifc.html">Excel Space Report from IFC</a>
		</li>
		
        <li>
			<a href="../examples/spatial-hierarchy.html">Spatial hierarchy</a>
		</li>
		<li role="separator" class="group-divider">Advanced </li>
		
        <li>
			<a href="../examples/federating-models.html">Federating Models</a>
		</li>
		
        <li>
			<a href="../examples/insert-copy-function.html">Insert Copy Function</a>
		</li>
        <li class="active">
			<a href="../examples/change-log-creation.html">Change Log Creation</a>
		</li>
		<li role="separator" class="group-divider">Web UI  </li>
		
        <li>
			<a href="../examples/hello-building.html">Hello Building</a>
		</li>
		
        <li>
			<a href="../examples/safe-hello-building.html">Safe Hello Building</a>
		</li>
		
        <li>
			<a href="../examples/eventful-building.html">Eventful Building</a>
		</li>
		
        <li>
			<a href="../examples/building-seen-from-everywhere.html">Building Seen from Everywhere</a>
		</li>
		
        <li>
			<a href="../examples/colourful-building.html">Colourful Building</a>
		</li>
		
        <li>
			<a href="../examples/pinpoint-the-view.html">Pinpoint the View</a>
		</li>
		
        <li>
			<a href="../examples/informational-overlay.html">Informational Overlay</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Release notes <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../release-notes/fast-upgrade-track.html">Fast Upgrade Track</a>
		</li>
		
        <li>
			<a href="../release-notes/xbim-4-release-notes.html">xBIM 4 Release Notes</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Research <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../research/history.html">History</a>
		</li>
		
        <li>
			<a href="../research/how-to-reference.html">How to reference</a>
		</li>
		
        <li>
			<a href="../research/ifc2x3-test-harness.html">Ifc2X3 Test Harness</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Downloads <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../downloads/xbimxplorer.html">XbimXplorer</a>
		</li>
    </ul>

		</li>
		
        <li>
			<a href="../cloud.html">Cloud</a>
		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">License <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../license/license.html">License</a>
		</li>
		
        <li>
			<a href="../license/third-party-licenses.html">Third Party Licenses</a>
		</li>
    </ul>

		</li>
    </ul>

        </div><!--/.nav-collapse -->
      </div>
    </nav>

	<div class="flex-add">
		Interested to see what we do in the cloud? Join us for one of our <a target="_blank" href="https://xbim.net/webinar/?utm_source=toolkit" target="_blank">webinars</a>!
	</div>


	<div class="container">
	<h1>Change Log Creation</h1>

<p>This is one of the interesting aspects of xbim. It is in a core of our design that every change happening in the model is
a part of a transaction. All transactions are created by an implementation of <code>IModel</code> and are weakly referenced from there
so when you use <code>using</code> statement model only keeps reference to the the transaction as long as you keep it. This means that 
there is a single point where all changes are happening and we can do something with them.</p>

<p>One obvious thing to do is to record all changes, previous states and next states. Combining all this together you can create 
either back-log or forward-log. To simplify this task we implemented a <code>Xbim.IO.Delta.TransactionLog</code> class. In the following example
we will have a look on how to use it.</p>

<div class="csharp"><pre><code><span class="keyword">using</span> <span class="type">System</span>;
<span class="keyword">using</span> <span class="type">Xbim</span>.Common;
<span class="keyword">using</span> <span class="type">Xbim</span>.Ifc;
<span class="keyword">using</span> <span class="type">Xbim</span>.Ifc4.Interfaces;
<span class="keyword">using</span> <span class="type">Xbim</span>.IO.Delta;
<span class="keyword">using</span> <span class="type">Xbim</span>.IO.Step21;
</code></pre></div>

<div class="csharp"><pre><code><span class="keyword">var</span> editor = <span class="keyword">new</span> <span class="type">XbimEditorCredentials</span>
{
    ApplicationDevelopersName = <span class="string">&quot;You&quot;</span>,
    ApplicationFullName = <span class="string">&quot;Your app&quot;</span>,
    ApplicationIdentifier = <span class="string">&quot;Your app ID&quot;</span>,
    ApplicationVersion = <span class="string">&quot;4.0&quot;</span>,
    <span class="comment">//your user</span>
    EditorsFamilyName = <span class="string">&quot;Santini Aichel&quot;</span>,
    EditorsGivenName = <span class="string">&quot;Johann Blasius&quot;</span>,
    EditorsOrganisationName = <span class="string">&quot;Independent Architecture&quot;</span>
};

<span class="keyword">using</span> (<span class="keyword">var</span> model = <span class="type">IfcStore</span>.Open(<span class="string">&quot;SampleHouse.ifc&quot;</span>, editor, <span class="keyword">true</span>))
{
    <span class="keyword">using</span> (<span class="keyword">var</span> txn = model.BeginTransaction(<span class="string">&quot;Modification&quot;</span>))
    {
        <span class="keyword">using</span> (<span class="keyword">var</span> log = <span class="keyword">new</span> TransactionLog(txn))
        {
            <span class="comment">//change to existing wall</span>
            <span class="keyword">var</span> wall = model.Instances.FirstOrDefault&lt;<span class="type">IIfcWall</span>&gt;();
            wall.Name = <span class="string">&quot;Unexpected name&quot;</span>;
            wall.GlobalId = <span class="type">Guid</span>.NewGuid().ToPart21();
            wall.Description = <span class="string">&quot;New and more descriptive description&quot;</span>;

            <span class="comment">//print all changes caused by this</span>
            PrintChanges(log);
            txn.Commit();
        }
        <span class="type">Console</span>.WriteLine();
    }
}
</code></pre></div>

<p>Previous code uses this simple function to report changes on the objects:</p>

<div class="csharp"><pre><code><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> PrintChanges(<span class="type">TransactionLog</span> log)
{
    <span class="keyword">foreach</span> (<span class="keyword">var</span> change <span class="keyword">in</span> log.Changes)
    {
        <span class="keyword">switch</span> (change.ChangeType)
        {
            <span class="keyword">case</span> <span class="type">ChangeType</span>.New:
                <span class="type">Console</span>.WriteLine(<span class="stringCSharpVerbatim">@&quot;New entity: {0}&quot;</span>, change.CurrentEntity);
                <span class="keyword">break</span>;
            <span class="keyword">case</span> <span class="type">ChangeType</span>.Deleted:
                <span class="type">Console</span>.WriteLine(<span class="stringCSharpVerbatim">@&quot;Deleted entity: {0}&quot;</span>, change.OriginalEntity);
                <span class="keyword">break</span>;
            <span class="keyword">case</span> <span class="type">ChangeType</span>.Modified:
                <span class="type">Console</span>.WriteLine(<span class="stringCSharpVerbatim">@&quot;Changed Entity: #{0}={1}&quot;</span>, change.Entity.EntityLabel, change.Entity.ExpressType.ExpressNameUpper);
                <span class="keyword">foreach</span> (<span class="keyword">var</span> prop <span class="keyword">in</span> change.ChangedProperties)
                    <span class="type">Console</span>.WriteLine(<span class="stringCSharpVerbatim">@&quot;        Property &#39;{0}&#39; changed from {1} to {2}&quot;</span>, prop.Name, prop.OriginalValue, prop.CurrentValue);
                <span class="keyword">break</span>;
            <span class="keyword">default</span>:
                <span class="keyword">break</span>;
        }
    }
}
</code></pre></div>

<p>Resulting change log will look like this. It contains more changes because xbim handles owner history automatically for you when you change or create any <code>IFCROOT</code> entity.</p>

<div class="step"><pre><code>Changed Entity: <span class="number">#1229</span>=<span class="type">IFCWALL</span>
        Property <span class="string">&#39;Name&#39;</span> changed from <span class="string">&#39;Basic Wall:Wall-Ext_102Bwk-75Ins-100LBlk-12P:285330&#39;</span> to <span class="string">&#39;Unexpected name&#39;</span>
        Property <span class="string">&#39;OwnerHistory&#39;</span> changed from <span class="number">#42</span> to <span class="number">#83873</span>
        Property <span class="string">&#39;GlobalId&#39;</span> changed from <span class="string">&#39;3cUkl32yn9qRSPvBJVyWw5&#39;</span> to <span class="string">&#39;0zxW3$9z95n8U_H9YOcyiE&#39;</span>
        Property <span class="string">&#39;Description&#39;</span> changed from $ to <span class="string">&#39;New and more descriptive description&#39;</span>
New entity: <span class="number">#83873</span>=<span class="type">IFCOWNERHISTORY</span>(<span class="number">#83876</span>,<span class="number">#83877</span>,$,.MODIFIED.,$,$,$,0);
New entity: <span class="number">#83874</span>=<span class="type">IFCPERSON</span>($,<span class="string">&#39;Santini Aichel&#39;</span>,<span class="string">&#39;Johann Blasius&#39;</span>,$,$,$,$,$);
New entity: <span class="number">#83875</span>=<span class="type">IFCORGANIZATION</span>($,<span class="string">&#39;Independent Architecture&#39;</span>,$,$,$);
New entity: <span class="number">#83876</span>=<span class="type">IFCPERSONANDORGANIZATION</span>(<span class="number">#83874</span>,<span class="number">#83875</span>,$);
New entity: <span class="number">#83878</span>=<span class="type">IFCORGANIZATION</span>($,<span class="string">&#39;You&#39;</span>,$,$,$);
New entity: <span class="number">#83877</span>=<span class="type">IFCAPPLICATION</span>(<span class="number">#83878</span>,$,<span class="string">&#39;Your app&#39;</span>,<span class="string">&#39;Your app ID&#39;</span>);
</code></pre></div>

    </div>
    <div id="invitation" class="container collapse">
		<p>
		Want to stay updated on xbim news and developments?
		</p>
		<a class="btn btn-primary" target="_blank" href="https://share.hsforms.com/1IQizWxh-SGCOQ0CQnikEJw3myli" target="_blank">Sign up for a newsletter</a>
		<button class="btn btn-default" id="btn-invitation-dismiss">Dismiss</button>
	</div>

	<div class="brands-container">
	<p><small>Some of the companies using xbim toolkit:</small></p>
		<a target="_blank" href="https://www.xbim.net"><img style="height:65px;" src="../img/xBim_parent_logo_white.svg" class="brand" alt="xbim ltd."></a>
		<img src="../img/logos/northumbria_logo_gray.png" class="brand"/>
		<img src="../img/logos/viewpoint_logo_gray.png" class="brand"/>
		<img src="../img/logos/welplan_logo_gray.png" class="brand"/>
		<img src="../img/logos/nbs_logo_gray.png" class="brand"/>
		<img src="../img/logos/bim_academy_logo_gray.png" class="brand"/>
		<img src="../img/logos/di5_logo_gray.png" class="brand"/>
		<img src="../img/logos/SEMA_logo_gray.png" class="brand"/>
	</div>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>
	<script src="../js/invitation.js"></script>
  </body>
</html>
